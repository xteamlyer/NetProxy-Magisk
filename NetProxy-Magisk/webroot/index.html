<!doctype html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>KernelSU æ¨¡å—</title><link rel="stylesheet" href="/netproxy.56933ac1.css"></head><body> <header class="top-nav"> <div class="top-nav-content"> <h1 id="pageTitle">é…ç½®æ–‡ä»¶ç®¡ç†</h1> <div class="action-buttons"> <span onclick="createConfig()" class="action-icon" id="createButton">â•</span> </div> </div> </header> <div class="container"> <div id="home" class="active page"> <div class="status-bar"> <div class="status-item"> <span class="status-label">è¿è¡ŒçŠ¶æ€ï¼š</span> <span id="runningStatus" class="status-value">åŠ è½½ä¸­...</span> </div> <div class="status-item"> <span class="status-label">å½“å‰é…ç½®ï¼š</span> <span id="currentConfig" class="status-value">åŠ è½½ä¸­...</span> </div> </div> <div class="config-list" id="configList">  </div> </div> <div id="editor" class="page"> <div class="card"> <div class="editor-header"> <h2 id="editorFileName">æ–‡ä»¶å</h2> <button onclick="saveConfig()" class="save-button">ä¿å­˜</button> </div> <textarea id="editorContent" class="editor-textarea"></textarea> </div> </div> <div id="system" class="page"> <div class="card"> <h2>ç³»ç»Ÿä¿¡æ¯</h2> <div id="systemInfo">åŠ è½½ä¸­...</div> </div> <div class="card"> <h2>æ‰§è¡Œå‘½ä»¤</h2> <input type="text" id="commandInput" placeholder="è¾“å…¥å‘½ä»¤..."> <button onclick="executeCommand()">æ‰§è¡Œ</button> <pre id="commandOutput"></pre> </div> </div> <div id="page3" class="page"> </div> <div id="page4" class="page"> </div> <div id="create" class="page"> <div class="card"> <div class="editor-header"> <h2>æ–°å»ºé…ç½®</h2> <button onclick="saveNewConfig()" class="save-button">ä¿å­˜</button> </div> <input type="text" id="newConfigName" class="config-name-input" placeholder="è¾“å…¥é…ç½®æ–‡ä»¶å..."> <textarea id="newConfigContent" class="editor-textarea" placeholder="è¾“å…¥é…ç½®æ–‡ä»¶å†…å®¹..."></textarea> </div> </div> </div> <nav class="bottom-nav"> <div class="active nav-item" onclick="switchPage('home')"> <span class="nav-icon">âš™ï¸</span> <span class="nav-text">é…ç½®</span> </div> <div class="nav-item" onclick="switchPage('system')"> <span class="nav-icon">ğŸ’»</span> <span class="nav-text">ç³»ç»Ÿ</span> </div> <div class="nav-item" onclick="switchPage('page3')"> <span class="nav-icon">ğŸ“Š</span> <span class="nav-text">ç»Ÿè®¡</span> </div> <div class="nav-item" onclick="switchPage('page4')"> <span class="nav-icon">âš¡</span> <span class="nav-text">çŠ¶æ€</span> </div> </nav> <div id="toggleButton" class="toggle-button" onclick="toggleService()"> <span class="toggle-icon">â–¶ï¸</span> </div> <script type="module">let t=0;function e(e,n){return void 0===n&&(n={}),new Promise((o,a)=>{let s=`exec_callback_${Date.now()}_${t++}`;function c(t){delete window[t]}window[s]=(t,e,n)=>{o({errno:t,stdout:e,stderr:n}),c(s)};try{ksu.exec(e,JSON.stringify(n),s)}catch(t){a(t),c(s)}})}function n(){this.listeners={}}function o(){this.listeners={},this.stdin=new n,this.stdout=new n,this.stderr=new n}function a(t){ksu.toast(t)}n.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},n.prototype.emit=function(t,...e){this.listeners[t]&&this.listeners[t].forEach(t=>t(...e))},o.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},o.prototype.emit=function(t,...e){this.listeners[t]&&this.listeners[t].forEach(t=>t(...e))};let s="",c="",i=null,r=null;async function d(){try{let{stdout:t}=await e(`find /data/adb/modules/netproxy/xraycore/config/ -type f -printf "%f\\n"`),n=t.split("\n").filter(t=>""!==t.trim()),o=document.getElementById("configList");if(o.innerHTML="",0===n.length){o.innerHTML='<div class="no-files">æš‚æ— é…ç½®æ–‡ä»¶</div>';return}n.forEach(t=>{let e=document.createElement("div");e.className="config-card",e.innerHTML=`
              <div class="config-card-header">
                <h3>${t}</h3>
                <div class="config-card-actions">
                  <button onclick="editConfig('${t}')" class="icon-button">\u{270F}\u{FE0F}</button>
                  <button onclick="handleDelete('${t}')" class="icon-button delete-button">\u{1F5D1}\u{FE0F}</button>
                </div>
              </div>
              <div class="config-card-status"></div>
            `,e.querySelector(".icon-button:not(.delete-button)").addEventListener("click",t=>{t.stopPropagation()});let n=e.querySelector(".delete-button");n.addEventListener("click",o=>{if(o.stopPropagation(),c===t)l(t),c="",i=null;else{c=t,i=n,n.classList.add("delete-pending");let o=e.querySelector(".config-card-status");o.textContent="å†æ¬¡ç‚¹å‡»åˆ é™¤æ–‡ä»¶",o.classList.add("show")}}),o.appendChild(e)})}catch(t){console.error("åŠ è½½é…ç½®æ–‡ä»¶åˆ—è¡¨å¤±è´¥:",t),document.getElementById("configList").innerHTML='<div class="error-message">åŠ è½½é…ç½®æ–‡ä»¶åˆ—è¡¨å¤±è´¥</div>',a("åŠ è½½é…ç½®æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}}async function l(t){try{await e(`rm /data/adb/modules/netproxy/xraycore/config/${t}`),a("åˆ é™¤æˆåŠŸ"),d()}catch(t){a("åˆ é™¤å¤±è´¥")}}async function u(){try{let{stdout:t}=await e("getprop ro.product.model");document.getElementById("systemInfo").textContent=`\u{8BBE}\u{5907}\u{578B}\u{53F7}: ${t}`}catch(t){a("è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥")}}async function m(){try{let{stdout:t}=await e("cat /data/adb/modules/netproxy/xraycore/xray_status.yaml"),n=t.match(/status:\s*"([^"]+)"/),o=t.match(/config:\s*"([^"]+)"/),a=n?n[1]:"unknown",s=o?o[1].split("/").pop():"unknown",c=document.getElementById("runningStatus"),i=document.getElementById("currentConfig"),d=document.getElementById("toggleButton"),l=d.querySelector(".toggle-icon");c.textContent="running"===a?"è¿è¡Œä¸­":"å·²åœæ­¢",c.className=`status-value ${"running"===a?"running":"stopped"}`,i.textContent=s,"running"===a?(d.classList.add("running"),l.textContent="â¹ï¸"):(d.classList.remove("running"),l.textContent="â–¶ï¸"),document.querySelectorAll(".config-card").forEach(t=>{t.querySelector("h3").textContent===s?(t.classList.add("selected"),r=t):t.classList.remove("selected")})}catch(t){console.error("è·å–è¿è¡ŒçŠ¶æ€å¤±è´¥:",t),document.getElementById("runningStatus").textContent="è·å–å¤±è´¥",document.getElementById("currentConfig").textContent="è·å–å¤±è´¥"}}async function y(t){try{let{stdout:n}=await e("cat /data/adb/modules/netproxy/xraycore/xray_status.yaml"),o=n.match(/status:\s*"([^"]+)"/),s=o?o[1]:"stopped";"running"===s&&(await e("su -c /data/adb/modules/netproxy/stop.sh"),a("æœåŠ¡å·²åœæ­¢"));let c=`status: "stopped"
config: "/data/adb/modules/netproxy/xraycore/config/${t}"`;await e(`echo '${c}' > /data/adb/modules/netproxy/xraycore/xray_status.yaml`),m()}catch(t){console.error("æ›´æ–°é…ç½®æ–‡ä»¶è·¯å¾„å¤±è´¥:",t),a("æ›´æ–°é…ç½®æ–‡ä»¶è·¯å¾„å¤±è´¥")}}document.addEventListener("click",t=>{if(!t.target.closest(".delete-button")&&i){i.classList.remove("delete-pending");let t=i.closest(".config-card").querySelector(".config-card-status");t.classList.remove("show"),t.textContent="",c="",i=null}if(t.target.closest(".config-card")){let e=t.target.closest(".config-card");r&&r!==e&&r.classList.remove("selected"),e.classList.toggle("selected"),(r=e.classList.contains("selected")?e:null)&&y(r.querySelector("h3").textContent)}}),window.editConfig=async function(t){try{let{stdout:n}=await e(`cat /data/adb/modules/netproxy/xraycore/config/${t}`);s=t,document.getElementById("editorFileName").textContent=t,document.getElementById("editorContent").value=n,switchPage("editor")}catch(t){a("åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥")}},window.saveConfig=async function(){let t=document.getElementById("editorContent").value;await e(`echo '${t}' > /data/adb/modules/netproxy/xraycore/config/${s}`),a("ä¿å­˜æˆåŠŸ"),switchPage("home")},window.executeCommand=async function(){let t=document.getElementById("commandInput").value;if(!t)return void a("è¯·è¾“å…¥å‘½ä»¤");try{let{stdout:n,stderr:o}=await e(t);document.getElementById("commandOutput").textContent=n||o}catch(t){a("å‘½ä»¤æ‰§è¡Œå¤±è´¥")}},window.createConfig=function(){document.getElementById("newConfigName").value="",document.getElementById("newConfigContent").value="",switchPage("create")},window.saveNewConfig=async function(){let t="/data/adb/modules/netproxy/xraycore/config/",n=document.getElementById("newConfigName").value.trim(),o=document.getElementById("newConfigContent").value;if(!n)return void a("è¯·è¾“å…¥é…ç½®æ–‡ä»¶å");let{stdout:s}=await e(`ls ${t}${n}`);if(s.trim()===n)return void a("é…ç½®æ–‡ä»¶å·²å­˜åœ¨");await e(`echo '${o}' > ${t}${n}`),a("åˆ›å»ºæˆåŠŸ"),document.getElementById("pageTitle").textContent="é…ç½®æ–‡ä»¶ç®¡ç†",document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")}),document.getElementById("home").classList.add("active"),document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")}),document.querySelector(".nav-item").classList.add("active"),document.getElementById("createButton").style.display="flex",d()},window.switchPage=function(t){document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")}),document.getElementById(t).classList.add("active"),document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")}),"editor"!==t&&"create"!==t&&event.currentTarget.classList.add("active"),document.getElementById("pageTitle").textContent=({home:"é…ç½®æ–‡ä»¶ç®¡ç†",system:"ç³»ç»Ÿä¿¡æ¯",page3:"ç»Ÿè®¡ä¿¡æ¯",page4:"è¿è¡ŒçŠ¶æ€",create:"æ–°å»ºé…ç½®"})[t]||"é…ç½®æ–‡ä»¶ç®¡ç†";let e=document.getElementById("createButton");"home"===t?e.style.display="flex":e.style.display="none"},window.toggleService=async function(){try{let{stdout:t}=await e("cat /data/adb/modules/netproxy/xraycore/xray_status.yaml"),n=t.match(/status:\s*"([^"]+)"/),o=n?n[1]:"unknown";"running"===o?(await e("su -c /data/adb/modules/netproxy/stop.sh"),a("æœåŠ¡å·²åœæ­¢")):(await e("su -c /data/adb/modules/netproxy/start.sh"),a("æœåŠ¡å·²å¯åŠ¨")),m()}catch(t){console.error("åˆ‡æ¢æœåŠ¡çŠ¶æ€å¤±è´¥:",t),a("æ“ä½œå¤±è´¥")}},d(),u(),m();</script> </body></html>