<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 禁用缓存 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="app-version" content="v1.0.2-20251224">
  <title>NetProxy</title>

  <!-- 防止 FOUC (Flash of Unstyled Content) - 关键CSS必须内联 -->
  <style>
    /* 遮罩层样式 */
    #fouc-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 99999;
      transition: opacity 0.15s ease-out;
    }

    #fouc-overlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }
  </style>

  <!-- 预先应用主题并设置遮罩颜色 -->
  <script>
    (function () {
      try {
        var savedTheme = localStorage.getItem('theme') || 'auto';
        var html = document.documentElement;

        // 移除所有主题类
        html.classList.remove('mdui-theme-light', 'mdui-theme-dark', 'mdui-theme-auto');

        // 判断实际应用的主题模式
        var isDark = savedTheme === 'dark' ||
          (savedTheme === 'auto' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);

        // 设置主题类
        if (savedTheme === 'light') {
          html.classList.add('mdui-theme-light');
        } else if (savedTheme === 'dark') {
          html.classList.add('mdui-theme-dark');
        } else {
          html.classList.add('mdui-theme-auto');
        }

        // 动态创建遮罩层的背景色样式
        var style = document.createElement('style');
        var fallbackColor = isDark ? '#141218' : '#fef7ff';

        if (savedTheme === 'auto') {
          // 自动模式：使用 KernelSU 注入的 Monet 变量，回退到默认颜色
          // --background 是 KernelSU colors.css 注入的莫奈取色变量
          style.textContent = '#fouc-overlay { background-color: var(--background, ' + fallbackColor + '); }';
        } else {
          // 手动模式：使用硬编码的颜色（因为手动模式下忽略 KernelSU 变量）
          style.textContent = '#fouc-overlay { background-color: ' + fallbackColor + '; }';
        }
        document.head.appendChild(style);
      } catch (e) {
        document.documentElement.classList.add('mdui-theme-auto');
      }
    })();
  </script>

  <!--
    CSS 加载顺序很重要！
    1. mdui.css - MDUI 组件库基础样式（通过 app.js 从 npm 包导入）
    2. material-icons.css - Material Icons 图标字体（本地字体，支持离线）
    3. KernelSU insets.css - 边到边适配（WebView 运行时注入）
    4. KernelSU colors.css - Monet 颜色变量（WebView 运行时注入）
    5. monet.css - 将 Monet 颜色映射到 MDUI 变量（必须在 colors.css 之后）
    6. style.css - 自定义样式（使用已覆盖的颜色变量）
  -->

  <!-- 1. Material Icons（本地字体文件，支持离线使用） -->
  <link rel="stylesheet" href="./assets/material-icons.css">

  <!-- 3. KernelSU WebUI 边到边适配 -->
  <!-- 在 KernelSU/APatch Manager WebView 中运行时动态提供 -->
  <link rel="stylesheet" href="https://mui.kernelsu.org/internal/insets.css">

  <!-- 4. KernelSU Monet 动态颜色 -->
  <!-- 在 Android 12+ 设备上注入系统 Monet 颜色变量 -->
  <link rel="stylesheet" href="https://mui.kernelsu.org/internal/colors.css">

  <!-- 5. Monet 颜色到 MDUI 的映射 -->
  <!-- 此文件将 KernelSU 注入的 Monet 变量覆盖到 MDUI 的颜色系统 -->
  <link rel="stylesheet" href="./monet.css">

  <!-- 6. 自定义样式 -->
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <!-- 遮罩层：覆盖页面直到样式加载完成 -->
  <div id="fouc-overlay"></div>

  <script>
    // 样式加载完成后淡出遮罩层
    (function () {
      function hideOverlay() {
        var overlay = document.getElementById('fouc-overlay');
        if (overlay) {
          overlay.classList.add('fade-out');
          setTimeout(function () {
            overlay.remove();
          }, 150);
        }
      }

      // 检测样式是否已加载
      function checkStylesLoaded() {
        // 检查 mdui 的 CSS 变量是否已定义
        var testEl = document.createElement('div');
        testEl.style.cssText = 'position:absolute;visibility:hidden;';
        document.body.appendChild(testEl);
        var computed = getComputedStyle(testEl);
        var mduiLoaded = computed.getPropertyValue('--mdui-color-primary') !== '';
        testEl.remove();
        return mduiLoaded;
      }

      // 使用 requestAnimationFrame 确保在渲染后检查
      function tryHideOverlay() {
        if (checkStylesLoaded()) {
          hideOverlay();
        } else {
          requestAnimationFrame(tryHideOverlay);
        }
      }

      // DOM 准备好后开始检查
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryHideOverlay);
      } else {
        requestAnimationFrame(tryHideOverlay);
      }

      // 超时保护：最多等待 2 秒
      setTimeout(hideOverlay, 2000);
    })();
  </script>
  <mdui-layout>
    <!-- Top App Bar -->
    <mdui-top-app-bar>
      <div style="width: 24px"></div>
      <mdui-top-app-bar-title>NetProxy</mdui-top-app-bar-title>
      <div style="flex-grow: 1"></div>
      <mdui-button-icon icon="brightness_6" id="theme-toggle" style="margin-right: 20px;"></mdui-button-icon>
    </mdui-top-app-bar>

    <!-- Main Content -->
    <mdui-layout-main id="main-content">
      <!-- Status Page -->
      <div id="status-page" class="page active">
        <div class="container">
          <!-- Service Status Card (redesigned) -->
          <mdui-card variant="elevated" class="compact-card status-card-new">
            <!-- Main Status Display -->
            <div class="status-main">
              <div class="status-left">
                <div class="status-badge" id="status-badge">
                  <div class="status-badge-dot" id="status-badge-dot"></div>
                  <span id="status-badge-text">检测中</span>
                </div>
                <div class="status-detail" id="status-detail">运行时间 --</div>
              </div>
              <mdui-chip id="status-chip-new">--</mdui-chip>
            </div>

            <!-- Info Grid -->
            <div class="info-grid">
              <div class="info-item">
                <mdui-icon name="settings" class="info-icon"></mdui-icon>
                <div class="info-content">
                  <div class="info-label">配置</div>
                  <div class="info-value" id="current-config-new">--</div>
                </div>
              </div>
              <div class="info-divider"></div>
              <div class="info-item">
                <mdui-icon name="memory" class="info-icon"></mdui-icon>
                <div class="info-content">
                  <div class="info-label">内存</div>
                  <div class="info-value" id="status-memory">--</div>
                </div>
              </div>
              <div class="info-divider"></div>
              <div class="info-item">
                <mdui-icon name="download" class="info-icon"></mdui-icon>
                <div class="info-content">
                  <div class="info-label">下载</div>
                  <div class="info-value" id="download-new">-- KB/s</div>
                </div>
              </div>
              <div class="info-divider"></div>
              <div class="info-item">
                <mdui-icon name="upload" class="info-icon"></mdui-icon>
                <div class="info-content">
                  <div class="info-label">上传</div>
                  <div class="info-value" id="upload-new">-- KB/s</div>
                </div>
              </div>
              <div class="info-divider"></div>
              <div class="info-item">
                <mdui-icon name="code" class="info-icon"></mdui-icon>
                <div class="info-content">
                  <div class="info-label">内核</div>
                  <div class="info-value" id="xray-version">--</div>
                </div>
                <mdui-button-icon id="check-update-btn" icon="system_update"
                  style="margin-left: auto;"></mdui-button-icon>
              </div>
            </div>
          </mdui-card>

          <!-- Latency Detection Card (truly horizontal) -->
          <mdui-card variant="elevated" class="compact-card">
            <div class="compact-header">
              <span class="card-compact-title">延迟检测</span>
              <mdui-button-icon id="refresh-latency-btn" icon="refresh"></mdui-button-icon>
            </div>
            <div class="latency-row">
              <div class="latency-cell">
                <span class="latency-label">百度</span>
                <span class="latency-value-horizontal" id="latency-baidu-compact">--</span>
              </div>
              <div class="latency-cell">
                <span class="latency-label">谷歌</span>
                <span class="latency-value-horizontal" id="latency-google-compact">--</span>
              </div>
              <div class="latency-cell">
                <span class="latency-label">GitHub</span>
                <span class="latency-value-horizontal" id="latency-github-compact">--</span>
              </div>
            </div>
          </mdui-card>
        </div>
      </div>

      <!-- Config Page -->
      <div id="config-page" class="page">
        <div class="container">
          <mdui-card variant="elevated">
            <div style="padding: 20px;">
              <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 16px;">
                <h2 style="margin: 0; font-size: 20px; flex-grow: 1;">节点管理</h2>
                <mdui-dropdown id="import-menu">
                  <mdui-button slot="trigger" icon="add" id="add-config-btn">添加</mdui-button>
                  <mdui-menu>
                    <mdui-menu-item id="import-node-link">
                      <mdui-icon slot="icon" name="link"></mdui-icon>
                      添加节点
                    </mdui-menu-item>
                    <mdui-menu-item id="import-full-config">
                      <mdui-icon slot="icon" name="description"></mdui-icon>
                      添加出站
                    </mdui-menu-item>
                    <mdui-menu-item id="import-subscription">
                      <mdui-icon slot="icon" name="rss_feed"></mdui-icon>
                      添加订阅
                    </mdui-menu-item>
                  </mdui-menu>
                </mdui-dropdown>
              </div>

              <!-- 分组横向标签页 (动态生成) -->
              <mdui-tabs id="config-tabs" style="max-width: 100%; overflow-x: auto;">
                <!-- 初始加载状态，由 JS 动态重建 -->
                <mdui-tab value="loading">加载中...</mdui-tab>
                <mdui-tab-panel slot="panel" value="loading">
                  <mdui-list>
                    <mdui-list-item>
                      <mdui-circular-progress></mdui-circular-progress>
                      <div slot="headline">加载中...</div>
                    </mdui-list-item>
                  </mdui-list>
                </mdui-tab-panel>
              </mdui-tabs>
            </div>
          </mdui-card>
        </div>
      </div>

      <!-- Proxy Settings Page -->
      <div id="uid-page" class="page">
        <div class="container">
          <!-- Unified App Proxy Settings Card -->
          <mdui-card variant="elevated" style="margin-bottom: 16px;">
            <div style="padding: 20px;">
              <h2 style="margin: 0 0 16px 0; font-size: 18px;">分应用设置</h2>
              <mdui-segmented-button-group id="app-proxy-mode-group" selects="single" value="off" style="width: 100%;">
                <mdui-segmented-button value="off" icon="power_settings_new">关闭</mdui-segmented-button>
                <mdui-segmented-button value="whitelist" icon="rule">白名单</mdui-segmented-button>
                <mdui-segmented-button value="blacklist" icon="block">黑名单</mdui-segmented-button>
              </mdui-segmented-button-group>
            </div>
          </mdui-card>

          <!-- App List Card -->
          <mdui-card variant="elevated" id="proxy-list-card">
            <div style="padding: 20px;">
              <div style="display: flex; align-items: center; margin-bottom: 16px;">
                <h2 style="margin: 0; font-size: 18px; flex-grow: 1;" id="proxy-list-title">排除应用</h2>
                <mdui-button icon="add" id="add-uid-btn">添加</mdui-button>
              </div>
              <mdui-list id="uid-list">
                <mdui-list-item>
                  <mdui-circular-progress></mdui-circular-progress>
                  <div slot="headline">加载中...</div>
                </mdui-list-item>
              </mdui-list>
            </div>
          </mdui-card>
        </div>
      </div>

      <!-- Logs Page -->
      <div id="logs-page" class="page">
        <div class="container">
          <!-- Service Log -->
          <mdui-collapse accordion>
            <mdui-collapse-item>
              <mdui-list-item slot="header" icon="description">
                服务日志
                <mdui-button-icon slot="end-icon" icon="refresh" id="refresh-service-log"></mdui-button-icon>
              </mdui-list-item>
              <div style="padding: 16px;">
                <div class="log-container" id="service-log">
                  <mdui-circular-progress></mdui-circular-progress>
                </div>
              </div>
            </mdui-collapse-item>
          </mdui-collapse>

          <!-- Xray Log -->
          <mdui-collapse accordion style="margin-top: 16px;">
            <mdui-collapse-item>
              <mdui-list-item slot="header" icon="description">
                Xray 日志
                <mdui-button-icon slot="end-icon" icon="refresh" id="refresh-xray-log"></mdui-button-icon>
              </mdui-list-item>
              <div style="padding: 16px;">
                <div class="log-container" id="xray-log">
                  <mdui-circular-progress></mdui-circular-progress>
                </div>
              </div>
            </mdui-collapse-item>
          </mdui-collapse>

          <!-- TProxy Log -->
          <mdui-collapse accordion style="margin-top: 16px;">
            <mdui-collapse-item>
              <mdui-list-item slot="header" icon="router">
                TProxy 日志
                <mdui-button-icon slot="end-icon" icon="refresh" id="refresh-tproxy-log"></mdui-button-icon>
              </mdui-list-item>
              <div style="padding: 16px;">
                <div class="log-container" id="tproxy-log">
                  <mdui-circular-progress></mdui-circular-progress>
                </div>
              </div>
            </mdui-collapse-item>
          </mdui-collapse>

          <!-- Update Log -->
          <mdui-collapse accordion style="margin-top: 16px;">
            <mdui-collapse-item>
              <mdui-list-item slot="header" icon="system_update">
                更新日志
                <mdui-button-icon slot="end-icon" icon="refresh" id="refresh-update-log"></mdui-button-icon>
              </mdui-list-item>
              <div style="padding: 16px;">
                <div class="log-container" id="update-log">
                  <mdui-circular-progress></mdui-circular-progress>
                </div>
              </div>
            </mdui-collapse-item>
          </mdui-collapse>

          <div
            style="padding: 16px; text-align: center; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <mdui-button variant="tonal" id="export-logs-btn" icon="folder_zip">
              保存日志
            </mdui-button>
            <mdui-button variant="tonal" id="export-all-btn" icon="backup">
              保存日志与配置
            </mdui-button>
            <mdui-button variant="outlined" id="logs-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings-page" class="page">
        <div class="container">
          <mdui-list>
            <!-- 模块设置入口 -->
            <mdui-list-item icon="settings_applications" id="settings-module-entry">
              模块设置
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- 代理设置入口 -->
            <mdui-list-item icon="swap_vert" id="settings-proxy-entry">
              代理设置
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- 路由设置入口 -->
            <mdui-list-item icon="alt_route" id="settings-routing-entry">
              路由规则
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- DNS设置入口 -->
            <mdui-list-item icon="dns" id="settings-dns-entry">
              DNS 设置
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- 主题设置 -->
            <mdui-list-item icon="palette" id="settings-theme">
              主题与颜色
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- 日志入口 -->
            <mdui-list-item icon="article" id="settings-logs-entry">
              日志
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <!-- 关于 -->
            <mdui-list-item icon="info" id="settings-about">
              关于
              <mdui-icon slot="end-icon" name="chevron_right"></mdui-icon>
            </mdui-list-item>
          </mdui-list>
        </div>
      </div>

      <!-- Module Settings Page -->
      <div id="module-page" class="page">
        <div class="container">
          <mdui-card variant="elevated" class="compact-card">
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px;">模块设置</h3>
              <p style="margin: 0; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                配置模块的基本行为
              </p>
            </div>
          </mdui-card>

          <mdui-list>
            <mdui-list-item icon="power_settings_new">
              开机自动启动
              <span slot="description">开机后自动启动代理服务</span>
              <mdui-switch slot="end-icon" id="module-auto-start"></mdui-switch>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <mdui-list-item icon="phone_android">
              OnePlus A16 兼容性修复
              <span slot="description">OnePlus Android 16 系统兼容性修复（清理系统添加的 REJECT 规则）</span>
              <mdui-switch slot="end-icon" id="module-oneplus-fix"></mdui-switch>
            </mdui-list-item>
          </mdui-list>

          <div style="padding: 16px; text-align: center;">
            <mdui-button variant="outlined" id="module-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>

      <!-- Routing Page -->
      <div id="routing-page" class="page">
        <div class="container">
          <mdui-card variant="elevated" class="compact-card">
            <div style="padding: 16px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <h3 style="margin: 0 0 8px;">路由规则设置</h3>
                <p style="margin: 0; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                  管理 Xray 路由规则
                </p>
              </div>
              <mdui-button id="add-routing-rule-btn" icon="add">添加</mdui-button>
            </div>
          </mdui-card>

          <mdui-list id="routing-rules-list" style="margin-top: 16px;">
            <mdui-list-item>
              <mdui-circular-progress></mdui-circular-progress>
              <span slot="description">加载中...</span>
            </mdui-list-item>
          </mdui-list>

          <div style="padding: 16px; text-align: center;">
            <mdui-button variant="outlined" id="routing-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>

      <!-- DNS Settings Page -->
      <div id="dns-page" class="page">
        <div class="container">
          <mdui-card variant="elevated" class="compact-card">
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px;">DNS 设置</h3>
              <p style="margin: 0; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                管理 DNS 服务器和静态 Hosts 映射
              </p>
            </div>
          </mdui-card>

          <mdui-tabs id="dns-tabs" value="servers" style="margin-top: 16px;">
            <mdui-tab value="servers">DNS 服务器</mdui-tab>
            <mdui-tab value="hosts">静态 Hosts</mdui-tab>

            <mdui-tab-panel slot="panel" value="servers">
              <div style="display: flex; justify-content: flex-end; padding: 12px 0;">
                <mdui-button id="add-dns-server-btn" icon="add">添加服务器</mdui-button>
              </div>
              <mdui-list id="dns-servers-list">
                <mdui-list-item>
                  <mdui-circular-progress></mdui-circular-progress>
                  <span slot="description">加载中...</span>
                </mdui-list-item>
              </mdui-list>
            </mdui-tab-panel>

            <mdui-tab-panel slot="panel" value="hosts">
              <div style="display: flex; justify-content: flex-end; padding: 12px 0;">
                <mdui-button id="add-dns-host-btn" icon="add">添加 Host</mdui-button>
              </div>
              <mdui-list id="dns-hosts-list">
                <mdui-list-item>
                  <mdui-circular-progress></mdui-circular-progress>
                  <span slot="description">加载中...</span>
                </mdui-list-item>
              </mdui-list>
            </mdui-tab-panel>
          </mdui-tabs>

          <div style="padding: 16px; text-align: center;">
            <mdui-button variant="outlined" id="dns-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>

      <!-- Proxy Settings Page -->
      <div id="proxy-settings-page" class="page">
        <div class="container">
          <mdui-card variant="elevated" class="compact-card">
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px;">代理设置</h3>
              <p style="margin: 0; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                配置哪些流量需要通过代理
              </p>
            </div>
          </mdui-card>

          <!-- 代理模式选择 -->
          <mdui-list style="margin-top: 16px;">
            <mdui-list-item>
              代理模式
              <span slot="description" id="proxy-mode-desc-settings">设置代理模式</span>
              <mdui-select slot="end-icon" id="proxy-mode-settings" value="0" style="width: 120px;">
                <mdui-menu-item value="0">自动</mdui-menu-item>
                <mdui-menu-item value="1">TPROXY</mdui-menu-item>
                <mdui-menu-item value="2">REDIRECT</mdui-menu-item>
              </mdui-select>
            </mdui-list-item>
          </mdui-list>

          <mdui-list id="proxy-settings-list" style="margin-top: 16px;">
            <mdui-list-item>
              移动数据
              <span slot="description">代理移动数据流量</span>
              <mdui-switch slot="end-icon" id="proxy-mobile"></mdui-switch>
            </mdui-list-item>

            <mdui-list-item>
              WiFi
              <span slot="description">代理 WiFi 流量</span>
              <mdui-switch slot="end-icon" id="proxy-wifi"></mdui-switch>
            </mdui-list-item>

            <mdui-list-item>
              热点
              <span slot="description">代理热点连接设备的流量</span>
              <mdui-switch slot="end-icon" id="proxy-hotspot"></mdui-switch>
            </mdui-list-item>

            <mdui-list-item>
              USB 共享
              <span slot="description">代理 USB 共享设备的流量</span>
              <mdui-switch slot="end-icon" id="proxy-usb"></mdui-switch>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <mdui-list-item>
              TCP
              <span slot="description">代理 TCP 流量</span>
              <mdui-switch slot="end-icon" id="proxy-tcp"></mdui-switch>
            </mdui-list-item>

            <mdui-list-item>
              UDP
              <span slot="description">代理 UDP 流量</span>
              <mdui-switch slot="end-icon" id="proxy-udp"></mdui-switch>
            </mdui-list-item>

            <mdui-divider></mdui-divider>

            <mdui-list-item>
              IPv6
              <span slot="description">启用 IPv6 代理</span>
              <mdui-switch slot="end-icon" id="proxy-ipv6"></mdui-switch>
            </mdui-list-item>
          </mdui-list>

          <div style="padding: 16px; text-align: center;">
            <mdui-button variant="outlined" id="proxy-settings-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>

      <!-- Theme Page -->
      <div id="theme-page" class="page">
        <div class="container">
          <!-- 模式设置 -->
          <mdui-card variant="elevated" class="compact-card">
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px;">外观模式</h3>
              <p style="margin: 0 0 16px; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                选择浅色、深色或跟随系统
              </p>
              <mdui-segmented-button-group id="theme-mode-group" selects="single" value="auto" style="width: 100%;">
                <mdui-segmented-button value="auto" icon="brightness_auto">自动</mdui-segmented-button>
                <mdui-segmented-button value="light" icon="light_mode">浅色</mdui-segmented-button>
                <mdui-segmented-button value="dark" icon="dark_mode">深色</mdui-segmented-button>
              </mdui-segmented-button-group>
            </div>
          </mdui-card>

          <!-- 主题色设置 -->
          <mdui-card variant="elevated" class="compact-card" style="margin-top: 16px;">
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px;">主题色</h3>
              <p style="margin: 0 0 16px; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                选择一个主题色
              </p>
              <div id="color-palette" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px;">
                <div class="color-item" data-color="#6750A4" style="background-color: #6750A4;" title="紫色 (默认)"></div>
                <div class="color-item" data-color="#0061A4" style="background-color: #0061A4;" title="蓝色"></div>
                <div class="color-item" data-color="#006B5F" style="background-color: #006B5F;" title="青色"></div>
                <div class="color-item" data-color="#006E1C" style="background-color: #006E1C;" title="绿色"></div>
                <div class="color-item" data-color="#8B5000" style="background-color: #8B5000;" title="橙色"></div>
                <div class="color-item" data-color="#BA1A1A" style="background-color: #BA1A1A;" title="红色"></div>
                <div class="color-item" data-color="#984061" style="background-color: #984061;" title="粉色"></div>
                <div class="color-item" data-color="#5D5D5D" style="background-color: #5D5D5D;" title="灰色"></div>
                <div class="color-item" data-color="#006874" style="background-color: #006874;" title="湖蓝"></div>
                <div class="color-item" data-color="#6B5778" style="background-color: #6B5778;" title="薰衣草"></div>
                <div class="color-item" data-color="#4758A9" style="background-color: #4758A9;" title="靛蓝"></div>
                <div class="color-item" data-color="#7C5800" style="background-color: #7C5800;" title="琥珀"></div>
              </div>
            </div>
          </mdui-card>

          <!-- 莫奈取色设置 -->
          <mdui-card variant="elevated" class="compact-card" style="margin-top: 16px;">
            <div style="padding: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <h3 style="margin: 0 0 4px;">莫奈取色</h3>
                  <p style="margin: 0; color: var(--mdui-color-on-surface-variant); font-size: 14px;">
                    从系统壁纸提取主题色（仅自动模式可用）
                  </p>
                </div>
                <mdui-switch id="monet-toggle" disabled></mdui-switch>
              </div>
            </div>
          </mdui-card>

          <div style="padding: 16px; text-align: center;">
            <mdui-button variant="outlined" id="theme-back-btn" icon="arrow_back">
              返回设置
            </mdui-button>
          </div>
        </div>
      </div>
    </mdui-layout-main>

    <!-- Bottom Navigation -->
    <mdui-navigation-bar value="status" id="nav-bar">
      <mdui-navigation-bar-item icon="home" value="status">状态</mdui-navigation-bar-item>
      <mdui-navigation-bar-item icon="hub" value="config">节点</mdui-navigation-bar-item>
      <mdui-navigation-bar-item icon="apps" value="uid">应用</mdui-navigation-bar-item>
      <mdui-navigation-bar-item icon="settings" value="settings">设置</mdui-navigation-bar-item>
    </mdui-navigation-bar>
  </mdui-layout>

  <!-- Floating Action Button -->
  <mdui-fab id="service-fab" icon="play_arrow"></mdui-fab>

  <!-- 确认删除对话框 -->
  <mdui-dialog id="confirm-dialog" close-on-esc close-on-overlay-click style="--mdui-dialog-max-width: 400px;">
    <div style="padding: 12px 8px 8px;">
      <h3 id="confirm-title" style="margin: 0 0 4px 0; font-size: 18px;">确认操作</h3>
      <div id="confirm-message" style="color: var(--mdui-color-on-surface-variant); line-height: 1.6;">
      </div>
    </div>
    <div style="padding: 0 12px 4px; display: flex; justify-content: flex-end;">
      <mdui-button id="confirm-cancel-btn">取消</mdui-button>
      <mdui-button id="confirm-ok-btn" variant="text" style="color: var(--mdui-color-error);">确定</mdui-button>
    </div>
  </mdui-dialog>



  <!-- Node Link Import Dialog -->
  <mdui-dialog id="node-link-dialog" headline="节点链接导入">
    <mdui-text-field label="节点链接" placeholder="支持: vless://, vmess://, trojan://, ss://, socks://, http://, https://"
      id="node-link-input" rows="3"></mdui-text-field>
    <mdui-button slot="action" variant="text" id="node-link-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="node-link-save">导入</mdui-button>
  </mdui-dialog>

  <!-- Subscription Dialog -->
  <mdui-dialog id="subscription-dialog" headline="添加订阅">
    <mdui-text-field label="订阅名称" placeholder="例如: 机场A" id="subscription-name"
      style="width: 100%; margin-bottom: 16px;"></mdui-text-field>
    <mdui-text-field label="订阅地址" placeholder="https://example.com/sub" id="subscription-url" style="width: 100%;"
      helper="支持 Base64 编码的订阅链接"></mdui-text-field>
    <mdui-button slot="action" variant="text" id="subscription-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="subscription-save">添加</mdui-button>
  </mdui-dialog>

  <!-- Config Editor Dialog -->
  <mdui-dialog id="config-dialog" headline="编辑配置" close-on-overlay-click="false">
    <mdui-text-field label="文件名" id="config-filename" style="width: 100%; margin-bottom: 16px;">
    </mdui-text-field>
    <mdui-text-field label="配置内容" id="config-content" rows="15" variant="outlined"
      style="width: 100%; font-family: monospace;">
    </mdui-text-field>
    <mdui-button slot="action" variant="text" id="config-cancel-btn">取消</mdui-button>
    <mdui-button slot="action" variant="text" id="config-save-btn">保存</mdui-button>
  </mdui-dialog>

  <!-- UID Add Dialog -->
  <mdui-dialog id="uid-dialog" headline="添加 UID" close-on-overlay-click="false">
    <mdui-text-field label="应用 UID" type="number" id="uid-input" helper="输入应用的 UID 编号" style="width: 100%;">
    </mdui-text-field>
    <mdui-button slot="action" variant="text" id="uid-cancel-btn">取消</mdui-button>
    <mdui-button slot="action" variant="text" id="uid-add-confirm-btn">添加</mdui-button>
  </mdui-dialog>

  <!-- App Selector Dialog -->
  <mdui-dialog id="app-selector-dialog" headline="选择应用" close-on-overlay-click="false"
    style="--mdui-dialog-max-width: 500px;">
    <mdui-text-field label="搜索应用" icon="search" id="app-selector-search" style="width: 100%; margin-bottom: 16px;">
    </mdui-text-field>

    <div style="display: flex; gap: 16px; margin-bottom: 16px;">
      <mdui-select id="app-selector-user" label="用户" style="flex-grow: 1;">
        <mdui-menu-item value="0">Owner (0)</mdui-menu-item>
      </mdui-select>
      <div style="display: flex; align-items: center;">
        <span style="font-size: 14px; margin-right: 8px;">显示系统应用</span>
        <mdui-switch id="app-selector-show-system"></mdui-switch>
      </div>
    </div>

    <div style="max-height: 400px; overflow-y: auto;">
      <mdui-list id="app-selector-list">
        <mdui-list-item style="padding: 16px;">
          <mdui-circular-progress style="margin: 0 auto;"></mdui-circular-progress>
          <div slot="headline" style="text-align: center;">加载应用列表...</div>
        </mdui-list-item>
      </mdui-list>
    </div>

    <mdui-button slot="action" variant="text" id="app-selector-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="app-selector-add-selected" disabled>添加选中 (0)</mdui-button>
  </mdui-dialog>

  <!-- Routing Rule Dialog -->
  <mdui-dialog id="routing-rule-dialog" headline="路由规则" close-on-overlay-click="false"
    style="--mdui-dialog-max-width: 500px;">
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <mdui-text-field label="规则名称" id="rule-name" placeholder="自定义规则名称" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="Domain (域名)" id="rule-domain" placeholder="用逗号(,)隔开，DOMAIN和IP二选一填写"
        helper="示例: example.com, geosite:cn" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="IP (地址段)" id="rule-ip" placeholder="用逗号(,)隔开，DOMAIN和IP二选一填写"
        helper="示例: 192.168.0.0/16, geoip:cn" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="Port (端口)" id="rule-port" placeholder="单端口或端口范围" helper="示例: 443 或 1-1024"
        style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="Protocol (协议)" id="rule-protocol" placeholder="http,tls,bittorrent" helper="用逗号隔开多个协议"
        style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="Network (网络类型)" id="rule-network" placeholder="tcp 或 udp 或 tcp,udp"
        style="width: 100%;"></mdui-text-field>

      <mdui-select label="OutboundTag (出站)" id="rule-outbound" value="proxy" style="width: 100%;">
        <mdui-menu-item value="proxy">Proxy (代理)</mdui-menu-item>
        <mdui-menu-item value="direct">Direct (直连)</mdui-menu-item>
        <mdui-menu-item value="block">Block (阻断)</mdui-menu-item>
      </mdui-select>
    </div>
    <mdui-button slot="action" variant="text" id="rule-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="rule-save">保存</mdui-button>
  </mdui-dialog>

  <!-- DNS Server Dialog -->
  <mdui-dialog id="dns-server-dialog" headline="DNS 服务器" close-on-overlay-click="false"
    style="--mdui-dialog-max-width: 500px;">
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <mdui-text-field label="服务器地址" id="dns-server-address" placeholder="IP 或 DoH URL"
        helper="示例: 8.8.8.8 或 https://dns.google/dns-query" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="域名匹配 (可选)" id="dns-server-domains" placeholder="用逗号分隔"
        helper="示例: domain:google.com, geosite:cn" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="期望 IP (可选)" id="dns-server-expect-ips" placeholder="用逗号分隔"
        helper="示例: geoip:cn, 223.0.0.0/8" style="width: 100%;"></mdui-text-field>

      <div style="display: flex; align-items: center; gap: 12px;">
        <mdui-switch id="dns-server-skip-fallback"></mdui-switch>
        <span>跳过 Fallback</span>
      </div>

      <mdui-text-field label="Tag (可选)" id="dns-server-tag" placeholder="自定义标识" style="width: 100%;"></mdui-text-field>
    </div>
    <mdui-button slot="action" variant="text" id="dns-server-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="dns-server-save">保存</mdui-button>
  </mdui-dialog>

  <!-- DNS Host Dialog -->
  <mdui-dialog id="dns-host-dialog" headline="静态 Host" close-on-overlay-click="false"
    style="--mdui-dialog-max-width: 500px;">
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <mdui-text-field label="域名" id="dns-host-domain" placeholder="域名或 geosite 规则"
        helper="示例: example.com 或 geosite:category-ads-all" style="width: 100%;"></mdui-text-field>

      <mdui-text-field label="目标 IP" id="dns-host-ip" placeholder="IP 地址，多个用逗号分隔"
        helper="示例: 127.0.0.1 或 192.168.1.1, 192.168.1.2" style="width: 100%;"></mdui-text-field>
    </div>
    <mdui-button slot="action" variant="text" id="dns-host-cancel">取消</mdui-button>
    <mdui-button slot="action" variant="filled" id="dns-host-save">保存</mdui-button>
  </mdui-dialog>

  <script type="module" src="./app.js"></script>
</body>

</html>